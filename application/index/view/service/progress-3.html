{extend name="layout/app" /}

{block name="title"}创业服务{/block}

{block name="ext_css"}

<link href="//cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/semantic-ui/2.1.8/semantic.min.css" rel="stylesheet">
<link rel="stylesheet" href="/static/index/css/style.css" />
{/block}

{block name="content"}

<div class="jumbotron jumbotron-custom">
    <p class="text-info text-center jumbotron-title">创业补贴申报系统</p>
</div>
<div class="container service-main-content">
    <div class="row service-container">
        {include file="service/service-head"}
        <div class="service-body" id="service-type">

            <div class="col-md-12 col-xs-12">
                <p class="type-title" style="padding-bottom: 0">1.上传身份证正、反面、学生证扫描件：</p>
            </div>
            <div class="col-md-12 col-xs-12">
                <div class="panel-upload">
                    <div class="panel-container">
                        <div class="panel-container-body">
                            <p class="text-orange">请您上传清晰、无污物、完整的证件原件照片或彩色扫描件，暂不支持ie浏览器上传功能。</p>
                            <div class="upload-container">
                                <div class="row">
                                    <form action="{:url('file/upload/uploadImage')}" enctype="multipart/form-data"  method="post" class="upload-photos">
                                        <div class="col-md-4 col-xs-12">
                                            <p class="text-muted">身份证正面：</p>
                                            <div class="text-center" style="background: #fff;">
                                                <img src="{if($cybt.file3 != null)}{$cybt.file3}{else}/static/index/images/default.png{/if}" alt="身份证正面照" class="img-thumbnail">
                                            </div>

                                            <div class="upload-footer">
                                                <button type="button" class="submit-photo">选择文件</button>
                                                <input type="file" name="image" accept="image/*" class="image-select">
                                                <input type="hidden" name="uid" value="{:\\think\\Session::get('uid')}">
                                                <input type="hidden" name="type" value="1">
                                                <input type="hidden" class="type_id" name="type_id" value="3">
                                                <a href="#" @click.stop.prevent="viewExample(1)" class="examples">查看示例</a>
                                                <a href="#" class="delete-image">删 除</a>
                                            </div>
                                        </div>
                                    </form>
                                    <form action="{:url('file/upload/uploadImage')}" enctype="multipart/form-data"  method="post" class="upload-photos">
                                        <div class="col-md-4 col-xs-12">
                                            <p class="text-muted">身份证反面：</p>
                                            <div class="text-center" style="background: #fff;">
                                                <img src="{if($cybt.file4 != null)}{$cybt.file4}{else}/static/index/images/default.png{/if}" alt="身份证反面照" class="img-thumbnail">
                                            </div>
                                            <div class="upload-footer">
                                                <button type="button" class="submit-photo">选择文件</button>
                                                <input type="file" name="image" accept="image/*" class="image-select">
                                                <input type="hidden" name="uid" value="{:\\think\\Session::get('uid')}">
                                                <input type="hidden" name="type" value="1">
                                                <input type="hidden" class="type_id" name="type_id" value="4">
                                                <a href="#" @click.stop.prevent="viewExample(2)" class="examples">查看示例</a>
                                                <a href="#" class="delete-image">删 除</a>
                                            </div>
                                        </div>
                                    </form>
                                    <form action="{:url('file/upload/uploadImage')}" enctype="multipart/form-data"  method="post" class="upload-photos">
                                        <div class="col-md-4 col-xs-12">
                                            <p class="text-muted">学生证第一面：</p>
                                            <div class="text-center" style="background: #fff;">
                                                <img src="{if($cybt.file5 != null)}{$cybt.file5}{else}/static/index/images/default.png{/if}" alt="学生证第一面" class="img-thumbnail">
                                            </div>
                                            <div class="upload-footer">
                                                <button type="button" class="submit-photo">选择文件</button>
                                                <input type="file" name="image" accept="image/*" class="image-select">
                                                <input type="hidden" name="uid" value="{:\\think\\Session::get('uid')}">
                                                <input type="hidden" name="type" value="1">
                                                <input type="hidden" class="type_id" name="type_id" value="5">
                                                <a href="#" @click.stop.prevent="viewExample(3)" class="examples">查看示例</a>
                                                <a href="#" class="delete-image">删 除</a>
                                            </div>
                                        </div>
                                    </form>

                                </div>

                            </div>
                        </div>


                    </div>
                </div>
            </div>
            <div class="col-md-12 col-xs-12">
                <p class="type-title" style="padding-bottom: 0">2.上传工商营业执照扫描件（可选）：</p>
            </div>
            <div class="col-md-12 col-xs-12">
                <div class="panel-upload">
                    <div class="panel-container">
                        <div class="panel-container-body">
                            <p class="text-orange">个人/团队领办的创业项目此项可选择上传，由创业实体领办的创业项目必须上传工商营业执照或民政登记证书扫描件，暂不支持ie浏览器上传功能。</p>
                            <div class="upload-container">
                                <div class="row">
                                    <form action="{:url('file/upload/uploadImage')}" enctype="multipart/form-data"  method="post" class="upload-photos">
                                        <div class="col-md-4 col-xs-12">
                                            <p class="text-muted">营业执照正面：</p>
                                            <div class="text-center" style="background: #fff;">
                                                <img src="{if($cybt.file6 != null)}{$cybt.file6}{else}/static/index/images/default.png{/if}" alt="营业执照" class="img-thumbnail">
                                            </div>
                                            <div class="upload-footer">
                                                <button type="button" class="submit-photo">选择文件</button>
                                                <input type="file" name="image" accept="image/*" class="image-select">
                                                <input type="hidden" name="uid" value="{:\\think\\Session::get('uid')}">
                                                <input type="hidden" name="type" value="1">
                                                <input type="hidden" class="type_id" name="type_id" value="6">
                                                <a href="#" class="delete-image">删 除</a>
                                            </div>
                                        </div>
                                    </form>
                                        <div class="col-md-4 col-xs-12">
                                            <p class="text-muted">示例：</p>
                                            <img src="/static/index/images/example.png" alt=""  class="img-thumbnail">
                                            <div class="upload-footer">
                                                <p class="text-muted" style="float: left;line-height: 42px;">营业执照正面扫描件</p>
                                                <a href="#" @click.stop.prevent="viewExample(4)" style="float: right;line-height: 42px">查看大图</a>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-xs-12">

                                            <div class="ui list text-orange" style="margin-top: 27px;">
                                                <div class="item">1. 营业执照上法定代表人/经营者姓名必须与学生证及身份证上姓名一致；</div>
                                                <div class="item">2. 扫描件不能PS；</div>
                                                <div class="item">3. 扫描件支持JPEG、PNG、GIF格式； </div>
                                            </div>
                                        </div>

                                </div>

                            </div>
                        </div>


                    </div>
                </div>
            </div>
            <div class="col-md-12 col-xs-12" style="margin-bottom: 28px;" id="agree">
                <input type="checkbox" v-model="agree"> 同意<a href="#" @click.stop.prevent="showRule" class="text-blue">创业补贴申报条款</a>
            </div>
            <div class="col-md-12 col-xs-12">
                <div class="col-md-3 col-md-offset-3">
                    <a href="{:url('index/service/cybtProgress',['id'=>\\Think\\Request::instance()->param('id'),'progress'=>2])}" class="btn btn-block btn-submit">上一步，提交项目资料</a>

                </div>
                <div class="col-md-3">
                    <a @click="finished()" v-bind:class="{'disabled' : !agree }" class="btn btn-block disabled btn-submit">下一步，完成申报</a>
                </div>
            </div>


        </div>
    </div>

</div>
<div class="modal" id='example1'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">示例 - 身份证正面</h4>
            </div>
            <div class="modal-body">
                <img src="/static/index/images/id-front.png" alt="" style="width: 100%">
            </div>
        </div>
    </div>
</div>
<div class="modal" id='example2'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">示例 - 身份证反面</h4>
            </div>
            <div class="modal-body">
                <img src="/static/index/images/id-back.png" alt="" style="width: 100%">
            </div>
        </div>
    </div>
</div>
<div class="modal" id='example3'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">示例 - 学生证正面</h4>
            </div>
            <div class="modal-body">
                <img src="/static/index/images/example.png" alt="" style="width: 100%">
            </div>
        </div>
    </div>
</div>
<div class="modal" id='example4'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">示例 - 营业执照</h4>
            </div>
            <div class="modal-body">
                <img src="/static/index/images/example.png" alt="" style="width: 100%">
            </div>
        </div>
    </div>
</div>
<div class="modal" id='rules'>
    <div class="modal-dialog" style="width: 760px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">创业补贴申报条款</h4>
            </div>
            <div class="modal-body">
                <strong>一、信息获取</strong>
                <p>学校毕业就业信息网、学院网站等。</p>
                <strong> 二、具体流程</strong>
                <p>（一）写创业项目计划书</p>
                <p>（二）在毕业就业信息网上下载附件：《在校大学生（高校毕业生）创业补贴申报表》，并填写。</p>
                <p>（三）向学院提出申请，并提供以下材料：学生证复印件、身份证复印件、创业项目计划书、《在校大学生（高校毕业生）创业补贴申报表》。</p>
                <p>1.由个人领办的创业项目由本人提出申请，应提供以下材料：本人学生证、身份证复印件、创业项目计划书、《在校大学生（高校毕业生）创业补贴申报表》。</p>
                <p>2.由创业团队领办的创业项目由团队负责人以团队名义提出申请，应提供以下材料：团队负责人学生证、身份证复印件、创业项目计划书、《在校大学生（高校毕业生）创业补贴申报表》</p>
                <p>3.创业实体由领办人提出申请，应提供以下材料：领办人学生证、身份证复印件、创业实体概述、工商注册或民政登记证书复印件（法定代表人姓名须与申请人姓名一致）、《在校大学生（高校毕业生）创业补贴申报表》。</p>
                <p>受理机构：</p>
                <p>各学院（所有材料均以学院为单位上交，学校不接受学生个人申报）。</p>
                <strong>三、申报时间</strong>
                <p>从2016年1月1日起，高校创业补贴实行月报制，各创业项目可于每月15日前以学院为单位提交创业补贴申报申请。</p>
                <strong>四、其他事项补充：</strong>
                <p>（一）创业项目计划书严禁弄虚作假，一旦发现雷同、抄袭情况，取消申报资格；</p>
                <p>（二）请各学院就业秘书及相关负责老师认真审核学生上报材料的各项内容，要求创业项目/创业实体的各项信息详实可信、有实际依据、未出现重复申请情况。</p>
                <p>（三）各学院请于每月15日前将各个项目完整材料(电子档与纸质档)和 《四川农业大学2016年毕业生创业补贴汇总表》（附件2）报招生就业处就业创业一科。
                </p>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="ext_js"}
<!-- 解决移动端单击300ms延迟问题 -->
<script type='application/javascript' src='/static/index/js/fastclick.js'></script>
<script src="//cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>
<script src="//cdn.bootcss.com/jquery.form/3.51/jquery.form.min.js"></script>
<script>
    $(function() {
        FastClick.attach(document.body);
    });
    $(document).ready(function(){
        $(".submit-photo").click(function(){
            $(this).nextAll(".image-select").click();
        });
        $(".image-select").on('change',function(){
            var file=$(this);
            var form=$(this).parents('form');
            var type_id=form.find(".type_id").val();
            var img=form.find(".img-thumbnail");
            form.ajaxSubmit({
                url:'{:url("file/upload/uploadImage")}',
                beforeSubmit:function(){
                    $(file).text("正在上传")
                    $(".btn-submit").addClass("ui loading button");
                },
                success:function(res){

                    $.ajax({
                        type:"POST",
                        dataType:"json",
                        data:{id:"{:$_GET['id']}",file_id:res.data.id,file_type:type_id},
                        url:"{:url('index/service/cybtFileTapped')}",
                        success:function(msg){
                            if(msg.code){
                                swal("","上传成功!","success")
                                $(".btn-submit").removeClass("ui loading button");

                            }else{
                                swal("",res.msg,"error");
                            }
                        },
                        error:function(){
                            swal("","抱歉,服务器出错了!","error");
                        }
                    });
                    $.ajax({
                        type:"POST",
                        dataType:"json",
                        data:{id:res.data.id},
                        url:"{:url('file/get/getSingleImage')}",
                        success:function(res){
                            img.attr('src',res);
                        }
                    });
                    $(".delete-image").attr('data-id',res.data.id);
                },
                resetForm: false,
                dataType:  'json'
            });
            return false;
        });
        $(".delete-image").click(function(){
           var form=$(this).parents('form');
           var img=form.find(".img-thumbnail");
           var data={id:$(this).attr('data-id')};
            $.ajax({
                type:"POST",
                dataType:"json",
                data:data,
                url:"{:url('file/delete/DeleteImage')}",
                success:function(){
                    img.attr('src',"/static/index/images/default.png");
                }
            });
            return false;
        });
    });
    new Vue({
        el:"body",
        data:{
            agree:false

        },
        methods:{
            viewExample:function(id){
                var data_id=id;
                switch(data_id){
                    case 1:$("#example1").modal('toggle');break;
                    case 2:$("#example2").modal('toggle');break;
                    case 3:$("#example3").modal('toggle');break;
                    case 4:$("#example4").modal('toggle');break;
                }

            },
            finished : function(){
                $.ajax({
                    type:"POST",
                    dataType:"json",
                    data:{id:"{:$_GET['id']}"},
                    url:"{:url('index/service/cybtSubmitTapped')}",
                    beforeSend:function(){
                        $(".btn-submit").addClass('ui loading button');
                        swal("","正在检查您的文件上传情况,请您耐心等待","warning");
                    },
                    success:function(res){
                        $(".btn-submit").removeClass('ui loading button');
                        if(res.code !== 1){
                            swal("",res.msg,"error");
                        }else{
                            location.href=res.url;
                        }
                    }
                })
            },
            showRule:function(){
                $("#rules").modal('toggle');
            }
        }
    })
</script>

{/block}